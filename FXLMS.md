# [主动降噪(Active Noise Control)](https://www.cnblogs.com/LXP-Never/p/11683944.html)
实际应用中，ANC降噪对2KHZ以下的信号噪声降噪效果比较好，**对高频噪声降噪效果很差**。原因为高频信号波长短，对相位偏差也比较敏感，导致ANC对高频噪声降噪效果差。**一般高频噪声可以被耳机物理的遮蔽屏蔽掉**，这种降噪被称为被动降噪。
上图是ANC系统的原理图，一共三层，用虚线分隔。最上一层primary path是从ref mic到error mic的声学通道，响应函数用P(z)P(z)表示；中间一层是模拟通道，其中secondary path是adaptive filter输出到返回残差的通路，包括DAC、reconstruction filter、power amplifier、speaker播放、再采集、pre-amplifier、anti-aliasing filter、ADC；最下一层是数字通路，其中adaptive filter不断调整滤波器权系数来削减残差，直到收敛。最常用的方案是用FIR滤波器结合LMS算法来实现adaptive filter。简化上图2，得到下图  
![](https://img2018.cnblogs.com/blog/1433301/201910/1433301-20191016152008229-1095148480.png)
再来说图3。这里adaptive filter输出后还要经过S(z)才去和desire output比较，S(z)会引起instability，用文献的话说，“the error signal is not correctly ‘aligned’ in time with the reference signal”，破坏了LMS的收敛性。一种有效的方法是FXLMS（Filtered-X LMS），也就让x(n)经过Sˆ(z)再输入给LMS 模块， S^(z)是S(z)的估计。FXLMS的objective：  
e2(n)=(d(n)−s(n)∗[wT(n)x(n)])2

所以gradient=−2e(n)s(n)∗x(n)，其中$s(n)$未知，用其estimate近似，所以FXLMS的更新公式是

w(n+1)=w(n)+μe(n)x′(n)
其中x′(n)=s^(n)∗x(n)


1. ANC为什么只针对2kHz以下的低频噪音？  
　　一方面，耳机的物理隔音方式（被动降噪）可以有效阻挡高频噪音，没必要用ANC降高频噪声。另一方面，**低频噪声波长较长，可以承受一定的相位延迟**，**而高频噪声波长短，对相位偏差敏感**，因此ANC消高频噪声并不理想。  
2. 当electronic delay比primary delay大时，算法性能大大下降如何理解？  
　　P(z)延时小，S(z)延时大，比如P(z)=z-1, S(z)=z-2，只有当W(z)=z才能满足要求，**非因果**，unreachable。  	
1. Feedforward ANC、narrow-band feedforward ANC、feedback ANC有什么区别？  
　　Feedforwad结构有一个ref mic和一个error mic，分别采集外部噪音和内部残差信号。feedback结构只有一个error mic，由error mic和adaptive filter output生成reference signal。  
　　Broad-band feedforward就是上面所述结构，而narrow-band结构中，noise source会产生某个signal触发signal generator，signal generator再生成reference signal送给adaptive filter。只适用于消除periodic noise。  
　　Feedback ANC由于只有error mic，用error mic来恢复feedforward结构中ref mic采集的信号，通路不满足因果约束，因此只消除predictable noise components，即窄带周期性噪声。需要注意的是，feedforward如果不满足因果约束，即electronic delay比主通道acoustic delay长的话，也只能消除窄带周期性噪声。  
　　另外还有一种Hybrid ANC的结构，同时包含feedforward和feedback结构，主要的优点是可以节省自适应滤波器的阶数。
  #  [主动噪声控制 (Active Noise Control, ANC)理论及Matlab代码实现](https://www.cnblogs.com/LXP-Never/p/11693567.html)
  
  　　实际情况中 基于前馈网络的自适应算法原理图如下所示了，LMS算法忽略了次级通道S(z)，**也就是说通过自适应滤波器生成的次级声源y(n)能够使得误差e(n)≈0，但是y(n)通过次级声道S(z)后的y′(n)就不一定能够使得e(n)≈0了**。因此**由于次级通道的存在，LMS算法通常会导致不稳定，误差信号在时间上未与参考信号正确对齐，存在延时**。可以使用多种可能的方案来补偿次级通道的影响。 Morgan提出了两种解决这个问题的方法。 第一种解决方案是放置一个与S(n)串联的逆滤波器1S(n)，以消除其影响。 **第二种解决方案是在参考信号路径中放置一个相同的滤波器，以实现LMS算法的权重更新**，从而实现所谓的FXLMS算法[9]。 由于S(n)不一定存在逆，因此FXLMS算法通常是最有效的方法。 FXLMS算法是由Widrow 在自适应控制和Burgess 的情况下独立导出的，用于ANC应用。

![](https://img2020.cnblogs.com/blog/1433301/202101/1433301-20210114095950313-149733396.png)
**FXLMS算法**

　　Widrow，Shur和Shaffer提出了考虑次级路径（从扬声器到误差麦克风）模型的方法[11]。 下图给出了Kuo和Morgan提出的FXLMS算法的框图，说明了降噪算法的工作原理

![](https://img2020.cnblogs.com/blog/1433301/202101/1433301-20210114100254179-1357503152.png)

符号定义

-   x(k)：噪声信号
-   P(z)：初级路径，p(n)初级路径传递函数
-   d(n)：误差传感器的初级噪声信号
-   S(z)：次级路径，S(n)次级路径传递函数
-   W(n)：自适应滤波器
-   y(n)：自适应滤波器的输出
-   y′(n)：通过次级路径的次级噪声信号
-   S^(z)：估计的次级路径
-   x′(n)：通过估计的次级路径，产生的噪声
-   e(n)：**误差信号**

1) 误差信号表示为

e(n)=d(n)−s(n)∗[wT(n)x(n)]

其中n是时间索引，s(n)是次级路径S(z)的脉冲响应，∗表示线性卷积，w(n)和x(n)分别是w(z)的系数和噪声信号。 

假设均方代价函数ξ(n)=E[e2(n)]，自适应滤波器使瞬时平方误差最小

ξ(n)=e2(n)

采用梯度下降算法，根据步长更新负梯度方向的滤波器权重向量

w(n+1)=w(n)−μ2▽ξ(n)

其中▽ξ(n)是时刻n的均方误差（MSE）梯度的瞬时估计，并表示为▽ξ(n)=▽e2(n)=2[▽e(n)]e(n)。我们得到▽e(n)=−s(n)∗x(n)=−x′(n)，权重更新变为

在实际的ANC应用中，S(z)是未知的，必须通过附加滤波器S^(z)进行估算。因此，通过使参考信号通过次级路径的此估计来生成滤波后的参考信号，其中s^(n)是次级的估计冲激响应。 。

x′(n)=s^(n)∗x(n)
  
  ## 次级通道在线辨识

　　就实际应用而言，次级通道的传递函数显然无法明确得知，而 **ANC 系统中的自适应滤波器可对次级通道进行估计**。当传递函数为时变函数时，采用在线辨识算法，即在 ANC 系统运行的同时对次级通道进行估计。下图给出了含在线辨识的 FXLMS 算法结构，自适应滤波器的输出yn引入线辨识系统，作为LMS 算法的输入。同时将系统中的残余噪声信号与yn经次级通道的估计之后得到的y^p(n)相比较，将所得到的误差也用作 LMS 算法的激励，调节参数，不断逼近次级通道传递函数，完成对次级通道的实时在线辨识。

![](https://img2018.cnblogs.com/blog/1433301/201910/1433301-20191017175208742-1083587056.png)

含在线辨识的 FXLMS 算法结构

　　次级通道的在线辨识应当满足两个基本要求：实现对次级通道较为精准的估计；同时在线辨识不应该对主降噪系统产生影响。而图 2.5 所示的次级通道的**在线辨识对y(n)进行直接处理，使得这两个基本要求相互矛盾**。故而实际的 ANC 系统应在在线辨识不被干扰与辨识不对主降噪系统产生干扰之间取得一个相对平衡。为在这两者间获取更为适宜的平衡点，Eriksson 提出增加辅助随机噪声作为在线辨识系统的激励，**而在主降噪系统中y(n)减去辅助噪声之后再驱动扬声器产生声音信号进入次级通道。但辅助噪声又对残余噪声造成了影响，Lan 在研究宽带 ANC系统时提出了通过|e(n)|对辅助噪声进行进一步的约束。刘在Lan 的基础上针对窄带前馈 ANC系统，改为利用|e(n−1)|对送入系统的辅助噪声进行约束，如图2.6 所示。本文所展开的在线辨识采用的正是该方法。**

　　次级通道的在线辨识可对时变次级通道传递函数进行估计，但同时增加了整个 ANC 系统的负担，此外，辅助噪声的存在仍在一定程度上削弱了 ANC 系统的鲁棒性。

![](https://img2018.cnblogs.com/blog/1433301/201910/1433301-20191017175342486-1353718925.png)

带自激的在线辨识FXLMS算法结构

## 次级通道离线辨识

　　当次级通道环境不随着时间而改变时，可以使用离线辨识算法。离线辨识是运行 ANC 系统进行降噪之前针对次级通道预先进行训练估计，固定并保存作为训练结果的次级通道模型，再将该模型引入到 ANC 系统并启动系统进行降噪。次级通道的离线辨识原理图如图 2.7 所示。

![](https://img2018.cnblogs.com/blog/1433301/201910/1433301-20191017175535734-1740336476.png)

次级通道离线辨识原理图

　　其中，白噪声信号v(n)作为系统在第n 时刻的激励，此刻次级通道的输出为d(n)，即离线辨识系统的期望信号。yv(n)则是白噪声激励信号经过次级通道的估计函数S^n(z)的输出，yv(n)与期望信号d(n)之差即为辨识误差eo(n)，送入到 LMS 算法中。经过不断迭代更新后当辨识误差eo(n)趋近于零时，yv(n)与期望信号d(n)趋近于相同，则可知次级通道的估计函数S^n(z)趋近于次级通道S(z)，实现了对次级通道的离线辨识。

　　离线辨识是脱离 ANC 降噪系统，独立进行系统辨识，不会给 ANC 降噪系统增加运行负担，同样不会损害 ANC 降噪系统的鲁棒性。若 ANC 系统的次级通道传递函数时不变，则离线辨识具有一定的优势，在本文后期具体实验时会给出更为直观的说明。

# FM 问题及非平稳

　　在前馈型 ANC 系统中，对参考信号的提取采用非声学传感器时，若传感器长时间工作将会累积损耗最终致使精度减削，采集到的参考信号频率将与实际初级噪声的频率存在误差。又或者，当信号发生器发出的信号不够精确，与期望存在误差。这些情况最终导致参考信号频率与实际噪声频率间存在误差，即所谓的 FM。

　　FM 问题对窄带前馈 ANC 具有致命性的影响力。哪怕系统中仅存在 1%的 FM 量，也将导致系统无法进行有效消噪。本文将在第三章和第六章分别从实时仿真以及实际实验两方面分析说明 FM 问题。

　　另外，噪声源设备的速度变化将直接表现为初级噪声信号频率的变化，而频率不稳定的初级噪声对系统的鲁棒性及跟踪能力有着毁坏性的损伤。非平稳一直是存在于实际的 ANC 应用中不可避免的又一问题，当初级噪声表现出非平稳时，采集参考信号的传感器会有响应延时并最终引起非平稳的 FM。在本文的第三章将对非平稳的 FM 进行仿真分析。
[英文](http://www.geocities.ws/ranjit_raphael/FXLMS.html)
[# 关于主动降噪耳机，你想知道的一切（一）](https://mp.weixin.qq.com/s/iS0bz8w9qrKCrQIO2PFN6Q)