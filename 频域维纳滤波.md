# [webRTC中语音降噪模块ANS细节详解(一)](https://www.cnblogs.com/talkaudiodev/p/15354511.html)
如图1所示，输入信号y(n)经过一个滤波器后产生一个输出信号x(n)，希望x(n)尽量逼近期望信号d(n)。这可以通过计算估计误差e(n)并使其最小化来实现，能够最小化这个估计误差的最优滤波器叫做维纳滤波器。

![](https://img2020.cnblogs.com/blog/1181527/202109/1181527-20210929210610157-1359807921.png)

通常维纳滤波器为线性的，且是FIR滤波器，因为FIR滤波器是稳定的，以及它是线性的方便计算。因而滤波器输出x(n)可以写成式1：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001090450785-1340498206.jpg)                                                       （1）

其中h(k)为滤波器系数，M为滤波器个数，即是M阶的滤波器。x(n)可以改写成式2：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001095024677-1794069500.png)                                                                                               （2）

其中h为M行1列的滤波器系数向量，y为M行1列的包括过去M个样本的输入向量。h和y表示如下：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001090353576-1019575998.jpg)

所以![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001091031281-1407379579.png)是一个实数值。

估计误差e(n)可以表示如式3：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001095253987-1982908192.png)                                                                     （3）

为了找到最优的滤波器系数，得求估计误差的统计均方值，即式4:

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001094452451-1376328370.png)                                                                                                   (4)

其中E[•]表示期望。因为

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001090814737-105519808.jpg)

所以

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001090853861-1015261825.jpg)

 令

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001091129463-740321960.png)

从而得到式5：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001091229668-209724135.jpg)                                                             （5）

展开后得到如下系列式子：

 ![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001091334006-187186449.jpg)

因为

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001091452998-279716594.png)

所以

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001091604832-619756979.jpg)

定义![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001091754583-239721759.png)表示两个输入值之间的自相关，n表示序列差。所以：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001091846520-253863197.jpg)

再定义![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001092021480-147571064.png)表示输入值和期望输出值之间的互相关，n表示序列差。所以：

 ![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001092107430-1803710244.jpg)

所以上面式子5可以改写成式子6

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001092226848-1941995756.jpg)      （6）

展开后得式7：

 ![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001092305384-1122277831.jpg)                                 （7）

再改写成如下形式，得到式8：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001092335640-1268581534.jpg)                                                 （8）

上面的式8是有限脉冲响应滤波器。再来考虑一种双边的无限脉冲滤波器，形式如式9：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001092421953-2125247321.jpg)                                                        （9）

则式8可写成式10：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001092640004-1400925469.jpg)                                              （10）

写成卷积形式，得到式11：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001092705520-2144876855.jpg)                                                                                         （11）

对两边做傅里叶变换，时域卷积变成频域就是乘积，所以得到式12：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001092743429-328290010.jpg)                                                                                      （12）

其中![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001100121845-314478765.png)是输入的自功率谱，自功率谱等于自相关的傅里叶变换。![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001100208331-321158449.png) 是输入与输出的互功率谱，互功率谱等于互相关的傅里叶变换。所以得到式13：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001092853374-849007348.jpg)                                                                                                  （13）

上式就是频域维纳滤波器的一般形式。

如果要把维纳滤波用到语音降噪上，图1中的y(n)就是带噪语音信号，x(n)就是纯净语音信号。假设n(n)表示噪声信号，如果只考虑加性噪声，则带噪语音信号、纯净语音信号和噪声信号的关系如下：y(n) = x(n) + n(n)，做傅里叶变换后的表达式如下：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001092953383-76789109.jpg)

 假设噪声与语音不相关且具有零均值，则

 ![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001093049218-272000145.jpg)

 ![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001093101147-2084137985.jpg)

其中![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001100001395-523471679.png)表示纯净语音的自功率谱，![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001100018790-174543892.png)表示噪声的自功率谱。

将![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001100424419-888393527.png)和![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001100445117-1897735026.png)带入式13可得式14：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001093214966-1132852021.png)                                                                               （14）

如果定义![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001093256565-1219071832.png)为频点为![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001093714397-600190374.png)时的先验信噪比(prior SNR，表示纯净语音和噪声的功率比值，后验信噪比（post SNR）表示带噪语音和噪声的功率比值) ，则式14可以表示为式15：

![](https://img2020.cnblogs.com/blog/1181527/202110/1181527-20211001093345055-1111876658.png)                                                                                          （15）