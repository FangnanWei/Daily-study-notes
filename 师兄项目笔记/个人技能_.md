## 1.AGC算法

### 1.AGC介绍

#### 1.AGC概念

由于性别的原因或讲话者的各自习惯不同，有的人喜欢离话筒远些，有的人喜欢离话筒近些，有的人声音大些，有的人声音小些，这些情况会导致在音频系统的输出端的音量幅度产生巨大的差别。

AGC可以针对上述这些情况自动给与“增益补偿”。通俗一点的讲，当讲话者的声音太大的时候， AGC会自动降低增益，从而使会议的扩声维持在一个恒定的音量上；反之，讲话者的声音太小，AGC会自动提高增益，以确保系统仍然维持在恒定的音量。在音频系统中，AGC可以根据“要求”，对声音信号自动给予“增益补偿”。因此通常用于调节各种会议系统的不同讲话者的声音音量平衡。

#### 2.AGC原理

- 源信号电平（Level）：讲话者的声音经话筒拾音，进入音频处理器的原始电平；
- 最小电平阈值（Min Threshold）：启动AGC的最小电平值；
- 目标电平（Target Level）：经过AGC自动调整的目标电平。

当输入电平大于所设定的Min Threshold, AGC会启动并自动根据所设定的Target Level对源信号进行增益补偿，并保持输入信号为恒定的Target Level.

1. **Level** < Min Threshold：AGC关闭，从而防止AGC将噪声电平放大输出
2. Min Threshold < **Level** < Target Level：AGC启动，并自动提高输入信号增益至目标电平
3. Min Threshold < Target Level < **Level**：AGC启动，并自动衰减输入信号增益至目标电平

#### 3.传统AGC的问题

在实际工作环境中，噪声的值实际上很难预测，它与有用信号之间有很大的重叠区域，但我们给定一个Min Threshold的时候，不是当有用信号非常低时AGC没有启动，就是噪声信号高于Min Threshold， AGC错误的启动。

## 2.VAD算法

### 1.VAD介绍

#### 1.VAD概念

VAD的作用是从一段语音（纯净或带噪）信号中标识出语音片段与非语音片段。VAD系统通常包括两个部分，特征提取和语音/非语音判决；

#### 2.常用特征

常用的特征提取可以分为五类：

- 基于能量：基于能量的准则是检测信号的强度，并且假设语音能量大于背景噪声能量，这样当能量大于某一门限时，可以认为有语音存在。然而当噪声大到和语音一样时，能量这个特征无法区分语音还是纯噪声。早先基于能量的方法，将宽带语音分成各个子带，在子带上求能量；因为语音在2KHz以下频带包含大量的能量，而噪声在24KHz或者4KHz以上频带比02HKz频带倾向有更高的能量。这其实就是频谱平坦度的概念，webrtc中已经用到了。在信噪比低于10dB时，语音和噪声的区分能力会加速下降。
- 频域：通过STFT将时域信号变成频域信号，即使在SNR到0dB时，一些频带的长时包络还是可以区分语音和噪声。

- 倒谱：对于VAD，能量倒谱峰值确定了语音信号的基频(pitch)，也有使用MFCC做为特征的;
- 谐波：语音的一个明显特征是包含了基频F0 及其多个谐波频率，即使在强噪声场景，谐波这一特征也是存在的。可以使用自相关的方法找到基频。
- 长时信息：语音是非稳态信号。普通语速通常每秒发出10~15个音素，音素见的谱分布是不一样的，这就导致了随着时间变化语音统计特性也是变化的。另一方面，日常的绝大多数噪声是稳态的（变化比较慢的），如白噪声/机器噪声。

#### 3.判决准则

判决准则可以分为三类：

- 基于门限：门限通常是根据目标场景的数据集预处理得到的，对于噪声变化的场景，需要使用自适应门限；
- 统计模型：WebRTC用定点化的方法实现了该似然比检验。取对数均值以提升判决的可靠性，但由于左侧log总是正数，因而这似然比偏向Hs，这种偏差可以通过减少只有噪声时似然比波动的判决引导（DD）方法来纠正，DD方法在与引导非语音变换区域容易发生错误，这又可以基于时域平滑减少错误的发生。
- 机器学习：机器学习法通常收集和标注训练集（音频集），提取合适的神经网络输入参数（特征），然后使用深度神经网络开发工具搭建网络模型，网络结构会使用（DNN、CNN、RNN、DCUNet）及他们组合的网络模型，根据训练结果选择适合的模型和参数作为部署模型。

### 2.WebRTC算法

#### 1.WebRTC的VAD处理流程

- 进行一些基本的检测，检测VAD结构体是否被初始化，语音帧长度是否满足条件。
- 对高采样频率的语音进行下采样，均采样到8kHz。
- 将语音信号频谱分割为6个子带，分别计算这6个子带的对数能量，作为GMM相关特征。还计算整体的频带能量total_energy用于计算GMM。（WebRtcVad_CalculateFeatures）
- **核心算法**：根据GMM模型，判断语音噪声标志，并更新模型参数。（WebRtcVad_GmmProbability）

#### 2.处理相关说明

##### 1.下采样：

以48kHz下采样到8kHz为例(WebRtcSpl_Resample48khzTo8khz)：首先48kHz下采样到24kHz，然后对24kHz的语音数据进行低通滤波(这一步并不改变采样率)，后面继续进行下采样24kHz->16kHz，16kHz->8kHz，最终得到8kHz的语音数据。

##### 2.子带分割(filter_bank.c)

首先将4kHz的数据分为0\~2kHz和2k\~4kHz，然后将2k\~4kHz部分划分为2k\~3kHz和3k\~4kHz两部分。0\~2kHz中则先分为0\~1kHz和1k\~2kHz两部分，其中0\~1kHz再分为0\~250Hz和250\~500Hz，最后对0\~250Hz部分进行80Hz高通滤波得到80\~250Hz的部分，至此得到六个子带：80\~250Hz，250\~500Hz，500\~1kHz，1k\~2kHz，2k\~3kHz，3k\~4kHz六个子带。取80Hz以上是由于我国居民用电为220V/50Hz，50Hz干扰会混入麦克风采集到的信号中。

##### 3.GMM模型(GmmProbability)

（1）根据帧长度设置各种阈值（用于鲁棒性输出和vad判断）

（2）total_power>kMinEnergy，帧总能量大于触发音频信号所需的最低能量，才进行后面步骤。

（3）计算模型输出判决，对于每一子带进行如下处理：

- 计算基于语音混合高斯模型的语音的概率P(X|H1)；计算基于噪声混合高斯模型的噪声的概率P(X|H0)；
- 根据语音概率和噪声概率，采用基于假设的似然比检验（LRT），计算语音与噪声的子带似然比，当其中某一子带似然比满足子带阈值，则判决为语音；
- 加权累加每一个子带的似然比得到整体似然比，判断整体似然比满足整体阈值，则判决为语音；
- 计算噪声H0和语音H1的每个高斯模型的条件概率分别存放在ngprevc和sgprvec两个向量里（用于模型参数的更新）

（4）更新模型参数，对每一子带做如下处理：

- 调用WebRtcVad_FindMinimum()函数对每个特征，求出100个帧里头的前16个最小值。每个最小值都对应一个age，最大不超过100，超过100则失效，用这个最小值来更新噪声；
- 调用WeightedAverage()函数，计算噪声高斯混合模型的均值和方差，计算语音高斯混合模型的均值和方差；
- 对于每一个单高斯模型，进行如下操作：更新每一个噪声高斯模型的均值μ；如果是语音帧，则更新每一个语音高斯模型的均值μ和方差σ；如果不是语音帧，则更新每一个噪声高斯模型的方差σ；
- 根据更新后的模型参数，再次调用WeightedAverage()函数，计算噪声和语音高斯混合模型的均值，比较两个均值的差值。如果小于阈值，则表明两个模型靠的太近，需要进行处理，使两个模型“分开”，分开后再重新计算两个模型的均值μ；
- 对噪声高斯混合模型的均值μ和语音高斯混合模型的均值μ进行最大值限制；

（5）帧数加1

（6）平滑处理，增强鲁棒性输出

## 3.波束形成技术

参考文献：[](https://www.cnblogs.com/LXP-Never/p/12239399.html)

### 1.基本概念与分类

**作用**：对多路麦克风信号进行合并处理，**增强目标方向**的声音信号，**抑制非目标方向** 的干扰信号。

**原理**：调整相位阵列的基本单元参数，使得某些角度的信号获得相长干涉，而另一些角度的信号获得相消干涉。对各个麦克风输出信号加权求和、滤波，最终输出期望方向的语音信号，相当于形成一个“波束”。

传统的波束形成技术主要分为固定波束形成和自适应波束形成技术。

1. **固定波束形成**：依赖目标场景的噪声特性和声场模型假设，波束计算过程不受信号数据变化的影响。
2. **自适应波束形成**：会对采集到的信号进行分析，根据分析的结果进一步推算波束形成的最优权重，进而得到波束结果。

根据**获取加权矢量时采用的方法**不同，可将波束形成方法分为三类：

1. 和参考信号数据无关的波束形成方法，如常规波束形成方法，这种波束形成方法通过加权取平均得到固定的阵列输出响应，阵列输出不受信号数据变化的影响；
2. 使用最佳权矢量的波束形成方法，这类方法依赖于对阵列接收数据统计特性的估计，如最大信噪比准则；
3. 可根据接收数据变化自适应地改变权矢量的波束形成方法，如最小方差无畸变响应（MVDR）波束形成、LMS算法、递推最小二乘（RLS）算法、采样矩阵求逆（SMI）算法等。

宽带波束形成主要分为**时域方法**和 **频域方法**：

1. 时域方法：对每个支路进行合适的延时，对各麦克风上接受信号的时间进行补偿，使信号到达阵列时等效为是同一波面同时到达各麦克风；
2. 频域方法：首先将宽带信号在频域分解为若干个子带，对子带信号进行窄带波束形成后，通过合成得到宽带波束输出。

由于时域方法受到采样精度的限制，多用于处理低频信号，处理高频信号更多采用频域方法。

### 2.麦克风阵列预备知识

#### 1.麦克风阵列

多个麦克风阵元在空间范围内按照不同的方式排列可以构成不同麦克风阵列拓扑结构。在实际的阵列设计和选择时要考虑麦克风数量、麦克风位置以及不同阵元间距对语音信号采集的影响。

麦克风阵列拓扑结构可分为：**一维线性阵**(均匀阵列、非均匀阵列和嵌套线性阵)、**二维面阵**(均匀和非均匀圆阵或方阵)和**三维立体阵**。

#### 2.空域混叠

时域采样为了避免频域混叠，采样率必须大于语音最高频率的两倍(奈奎斯特采样定理)。与之类似，阵列属于空域采样，为了避免空域混叠，需要满足$\cfrac1d≥2f_{max}$，其中d是麦克风间距。$f_{max}=\cfrac{1}{\lambda_{min}}$是波束形成要处理的最大频率，可以得到麦克风之间的距离满足$d<\cfrac{\lambda_{min}}2$，$\lambda_{min}$是波束形成要处理的最小波长。频率越高，波长越短，越容易产生空域混叠。（8kHz的波长时0.0425m, 因此麦克风之间的间距应该小于0.02125m）

#### 3.近场与远场

以均匀线性阵列为例。假设声源S到阵列坐标中心的距离为r，任意两个相邻阵列间的间距为d，声波波长的最小值为$\lambda_{min}$，λ=μT，μ是声速，T是周期，近场和远场模型如下图所示：

![img](https://img2018.cnblogs.com/i1/1433301/201912/1433301-20191214150732619-528845599.png)

超过了这个距离就是远场，球面波变成平面波。

- **近场模型**：不同麦克风接收到的**信号幅度 受信号源到各麦克风距离差异的影响非常明显**，需考虑信号源到达不同麦克风的**波程差**和**振幅差**。声波视为**球面波**；
- **远场模型**：不同麦克风接收信号的**幅度差异较小**，因此把不同麦克风采集的语音信号的幅值认为都是一样的，只需对各麦克风接收信号的**相位差异**进行处理即可。声波视为**平面波**。

#### 4.噪声场

相干噪声场、非相干噪声场：$\tau_{ij}(f)=\cfrac{\phi_{ij}(f)}{\sqrt{\phi_{ii}(f)\phi_{jj}(f)}}$

散射噪声场：$\tau_{ij}=sinc(\cfrac{2\pi f d_{ij}}{c})$

相干噪声（环境噪音） ；

非相干噪声（器件底噪）；

散射噪声（环境反射散射） 建模使用辛格函数 零阶贝塞尔函数；

#### 5.声辐射

声音的方向性和频率有关，频率越高，方向性越强，辐射角度越小。

不同信号辐射角度不同波束宽度对于频率无对应改变会导致波束后信号频率之比差异很大，导致失真，语音品质

解决方法：低频带和高频带分别处理；

![img](https://img2022.cnblogs.com/blog/1433301/202205/1433301-20220531105033364-1720840214.png)

### 3.延迟求和波束形成（DSB）

**原理**：首先对不同麦克风信号之间的相对延迟进行补偿，然后叠加延时后的信号形成一个单一的输出。

**缺点**：

- 需要麦克风的数量相对较多，
- 如果噪声源是相干的，降噪效果会强烈地依赖于噪声信号的到达方向，延迟求和波束形成在混响环境中的性能往往是不够好的。

**优点**：

- 由于可以有效地减轻非相干噪声，该类波束形成器仍然被广泛使用。

### 4.最小方差无失真响应波束形成（MVDR）

参考链接：[](https://blog.csdn.net/weixin_45424997/article/details/108363599)

#### 1.MVDR算法原理

期望信号无失真的约束条件下，选择合适的滤波器系数，使得阵列输出的平均功率最小化。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200526215253228.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3B3YW5nOTU=,size_16,color_FFFFFF,t_70#pic_center)

假设有M个阵元，N个信号$s_1(n),s_2(n),...,s_N(n)$分布从$\theta_1,\theta_2,...,\theta_N$入射到阵列时，接收信号可以表示为
$$
x(n)_{M\Chi1}=A_{M\Chi N}s_{N\Chi1}=[a_1(n),a_2(n),...,a_N(n)]_{M\Chi N}\Chi[s_1(n),s_2(n),...,s_N(n)]_{1\Chi N}^T
$$
MVDR的权重优化问题可以表示为
$$
\begin{cases}
min:P=w^HR_xw\\
st:w^Ha(\theta)=1
\end{cases}
$$
计算w，使得$a(\theta)$方向的信号可以完全通过，其他信号尽可能的被最大抑制。其中，$a(\theta)$为目标信号导向矢量，表示声源方向与麦克风之间的传递函数，$R_x$为空间信号相关协方差矩阵，根据快拍次数估计得到，由拉格朗日乘子法可得权向量为：
$$
w=\cfrac{R_x^{-1}a(\theta)}{a(\theta)^HR_x^{-1}a(\theta)}
$$
因为约束条件是纯净语音信号无失真，即纯净语音信号是保持不变的，为了使得输出的方差最小化，仅仅只需要让噪声信号最小化。所以上式信号相关矩阵$R_x$可以用噪声相关矩阵$R_n$替换。

- 当$R_n$为非相干噪声场的相关矩阵，则MVDR退化为延迟求和波束形成器，
- 当$R_n$为散射噪声场的相关矩阵，则MVDR退化为超指向性波束形成器。

#### 2.MVDR确定导向矢量

$$
P =E[|y(n)|^2]=E[w^Hx(n)x^H(n)w]=w^HRw=\cfrac{1}{a(\theta)^HR^{-1}a(\theta)}
$$

任意给一个角度，就有其对应的导向矢量$a(\theta)$，如果这个方向有信号，那么上式计算出来的P就是此方向信号平均功率，其值应该较大；如果没有信号只有噪声，那么计算出来的就是噪声平均功率，其值应该较小。
因此，将$\theta$在自己想观察的位置扫描一圈，每个地方都计算一遍功率，选出其中较大的值，其对应的 θ 就是测试的$a(\theta)$​。

#### 3.MVDR计算步骤

**确定导向矢量**：

Step1：由接收到的快拍信号 x(n) 估计自相关矩阵$R_x$；
Step2：计算自相关矩阵 $R_x$ 的逆矩阵$R_x^{-1}$ ；
Step3：按照阵列几何形状，构造对应的导向矢量$a(\theta)$；
Step4：使$a(\theta)$根据公式计算加权向量w和功率$P_{\theta}$；
Step4：使$a(\theta)$按照一定的步进，在自己想观察的角度扫描，逐次计算$P_{\theta}$；
Step5：对$P_{\theta}$进行谱峰搜索，找出峰值点对应的$\theta$；

**求权向量w**：

Step1：由接收到的快拍信号 x(n) 估计自相关矩阵$R_x$；
Step2：计算自相关矩阵 $R_x$ 的逆矩阵$R_x^{-1}$ ；
Step3：根据公式求加权向量w；
Step4：对输入x(n)作加权后相加，得到输出$y(n)=w^Hx(n)$；

### 5.线性约束最小方差波束形成（LCMV）

参考链接：[](https://blog.csdn.net/weixin_45424997/article/details/110840233)

LCMV 波束形成在效果上实际是 MVDR 波束形成的扩展形式，它将后者中期望信号不受影响的这一约束扩展为一组约束，即为目标方向无失真同时对其它噪声干扰方向陷零。

**原理**：在满足一组约束的同时，使波束形成输出(干扰信号、噪声)的功率最小化。与MVDR类似。空间中存在期望信号$x_d(t)$，其导向矢量为$a(\theta_d)$，以及M-1个干扰信号$x_j(t)$，其导向矢量为$a(\theta_j)$，阵列个数为N。

LCMV的约束条件可以表示为：
$$
\begin{cases}
min:P=w^HR_xw\\
st:A(\theta)W=g
\end{cases}
$$
其中，$A(\theta)=[a(\theta_d);a(\theta_j);...,a(\theta_{N-1})]_{M\Chi N}$，$g=\begin{bmatrix} 1\\ 0\\ ...\\ 0\\ \end{bmatrix}_{N\Chi1}$。计算w，使得$a(\theta)$方向的信号可以完全通过，其他信号尽可能抑制掉。其中，$a(\theta)$为目标信号导向矢量，表示声源方向与麦克风之间的传递函数，$R_x$为空间信号相关协方差矩阵，根据快拍次数估计得到，由拉格朗日乘子法可得权向量为：
$$
w=R_x^{-1}A(\theta)(A^H(\theta)R_x^{-1}A(\theta))^{-1}g
$$
当LCMV方法的约束条件取$a(\theta)^Hw=w^Ha(\theta)=1$时，演变为最小方差无失真响应波束形成器（MVDR）。

- **优点**：广义约束
- **缺点**：须知信号波达方向

### 6.广义旁瓣相消波束形成（GSC）

参考链接：[](https://blog.csdn.net/weixin_45424997/article/details/111035905)

#### 1.GSC算法介绍

在纯延时条件下 GSC 是 LCMV 的一种等效实现结构，GSC 结构将 LCMV 的约束优化问题转化为了无约束的优化问题。

**原理**：GSC 将LCMV 权重矢量分解为**自适应权重**和**非自适应权重**两个部分，其中非自适应权重位于约束子空间中，自适应权重位于约束空间的正交空间中。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20201213192900841.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQyNDk5Nw==,size_8,color_FFFFFF,t_70)

GSC是LCMV的等效实现方式，主要由主路和辅路两部分组成，如图所示

（1）目标信号从主路通过，使用固定波束形成结果，$w_q$表示；

（2）用阻塞矩阵B滤除语音信号，噪声和干扰从辅路通过，使用自适应方法估计噪声和干扰，$w_a$表示。

由此权矢量可表示为：
$$
w=w_q-Bw_a
$$
其中：$w_q=(CC^H)^{-1}Cg$为非自适应权重，是权重矢量$w_{LCMV}$在约束子空间上的投影，约束子空间由约束矩阵C表示；

​			$w_a=(B^HR_xB)^{−1}B^HR_xw_q$为自适应权重，是权重矢量$w_{LCMV}$在最小方差子空间上的投影。

最小方差子空间由M*(M-N)维的阻塞矩阵B表示，B的作用就是就是保证目标信号不进入辅路。组成B的列矢量处于约束子空间的正交互补空间中。由于约束矩阵和阻塞矩阵是相互正交的所以必须满足$B^HC=0$。

#### 2.GSC算法推导

##### 1.非自适应部分

某时刻空间中存在N个信号与噪声，其中N-1个为干扰信号，由M个阵元接收,N < M，输入信号为：
$$
u(t)=x_d(t)a(\theta_d)+\sum_{j=1}^{N-1}x_j(t)a(\theta_j)+N(t)
$$
类似LCMV有如下约束：
$$
C^Hw_q=g
$$
$C_{M\Chi N}$是由期望方向和干扰方向导向矢量列向量组成的**约束矩阵**，类似LCMV，在GSC中$w_q$固定波束形成权向量
$$
w_q=C(C^HC)^{-1}g
$$
使用$w_q$并没有将干扰消除掉，而是降低了干扰信号响应。还是既包含信号，又包含干扰和噪声。为了能进一步降低干扰和噪声，继续进行处理。引入阻塞矩阵B，来阻止期望信号进入辅路。

##### 2.自适应部分

约束子空间由约束矩阵C的列向量张成，维度M×N；约束子空间的正交补空间B，其维度为M×(M-N)。因为其正交，所以：
$$
B^HC=0\\
B^Hu(t)=B^H\sum_{j=1}^{M-1}x_j(t)a(\theta_j)+B^HN(t)\\
C^Hu(t)=x_d(t)+a(\theta_d)^H\sum_{j=1}^{M-1}x_j(t)a(\theta_j)+a(\theta_d)^HN(t)
$$
$B^Hu(t)$：所以u(t)和阻塞矩阵相乘后，期望信号就为零了，得到的干扰+噪声。

$C^Hu(t)$：为经过DS滤波后，得到的期望信号+剩余的的干扰和噪声。

接下来使用维纳滤波器，使d(n)为$C^Hu(t)$，x(n)为$B^Hu(t)$，即使用干扰+噪声作为输入信号，期望信号+剩余的的干扰和噪声作为导师信号，由于假设期望信号与干扰和噪声不相关，只会消除掉干扰和噪声，即可实现。

带入维纳滤波器表达式得：
$$
w=w_q-Bw_a
$$

#### 3.阻塞矩阵B的选取

##### 1.对消法构造阻塞矩阵

![img](https://images2015.cnblogs.com/blog/1085343/201703/1085343-20170326091707361-872552287.png)

##### 2.QR分解构造阻塞矩阵

![img](https://images2015.cnblogs.com/blog/1085343/201703/1085343-20170326091828940-1359180730.png)

##### 3.基于SVD分解构造阻塞矩阵

![img](https://images2015.cnblogs.com/blog/1085343/201703/1085343-20170326091837830-923576805.png)

##### 4.正交法构造阻塞矩阵

![img](https://images2015.cnblogs.com/blog/1085343/201703/1085343-20170326091844440-1611634837.png)

#### 4.GSC算法优缺点

- 优点：当自适应支路中包含较少目标信号时，GSC效果较好；
- 缺点：当声源移动或者混响比较严重时，自适应支路中包含的目标信号超过一定程度，将会产生期望信号的泄露，在接下来的自适应滤波过程中会造成噪声信号与上支路期望语音信号相互抵消的现象，导致期望语音的失真，算法性能下降。

### 7.后置滤波技术

波束形成方法在实际使用时，由于各种非理想假设导致的SNR提升与理论最大值有较大的差距，且也无法消除同方向的噪声，后置滤波的提出是为了进一步提高噪声和干扰的抑制能力。后置滤波可以用来**去除非相干噪声**，但是在相干噪声情况下性能退化，甚至不可用。后置滤波主要是通过估计语音、噪声，以及干扰的功率谱密度对波束的结果进一步处理，以降低噪声和干扰。

#### 1.Zelinski后置滤波

Zelinski后置滤波器方法根据通道间的互功率谱密度采用维纳滤波器进一步抑制噪声和干扰。并在估计语音的自功率谱时是基于如下假设：

- 噪声在不同麦克风之间是无关的；
- 噪声和信号是不相关的；
- 所有麦克风中的噪声功率谱均相同；

**原理**：设定y是延迟和波束输出值，s是原始纯净信号，x是带噪信号；平滑后观测信号的自相关功率谱密度和互相关功率谱密度，可以如下递归估计
$$
\hat R_{yiyj}(n+1)=\alpha \hat R_{yiyj}(n)+(1-\alpha)y_i^*y_j\\
w=\cfrac{\cfrac{2}{M(M-1)}\sum_{i=1}^{M-1}\sum_{j=i+1}^MRe[\hat R_{xiyi(n)}]}{\cfrac1N\sum_{i=1}^N\hat R_{yiyi}(n)}
$$
**缺点**：由于 Zelinski后置滤波器在估计噪声时并没有考虑到前面波束形成的降噪作用，使得噪声被过估计，因此Zelinski后置滤波器在理论上是次优的。

**问题**：仅仅只解决了在非相干噪声场中不相关噪声信号的抑制问题，但在实际生活中纯非相干噪声场的使用场景比较少，我们一般对常见的扩散噪声场更感兴趣。

#### 2.McCowan后置滤波

McCowan 后置滤波并没有假设不同麦克风之间的噪声是不相关的，考虑到麦克风之间接收噪声的相关性，且假设噪声是已知的散射噪声场，用噪声相关函数Γy(f)表示。

**缺点**：同样是由于噪声过估计问题，Mc Cowan 后置滤波器是理论次优的。

#### 3.最优修正对数谱幅度后置滤波

维纳滤波器基于均方误差准则，并不能得到最优的频谱，更合适的方法是基于**谱幅度的均方误差**或**对数谱幅度的均方误差**。在对数谱幅度估计器的基础上结合语音的存在概率提出了最优修正对数谱幅度估计器。

在期望语音信号和噪声信号经过离散傅里叶变换后，假设其傅里叶系数的实部和虚部均满足均值为零的高斯分布，在此条件下基于对数短时谱幅度最小均方误差的估计器，可以分解为MVDR自适应波束形成器后接入一个单通道的对数短时谱幅度后置滤波器。

 Cohen 率先将最优修正对数谱幅度估计器用于麦克风阵列后置滤波部分，其表达式如下所示：
$$
w=(\cfrac{\xi(t,f)}{1+\xi(t,f)}exp(\cfrac12\int_{v(t,f)}^\infty\cfrac{e^{-t}}{t}))^{p(t,f)}G_{min}^{1-p(t,f)}\\
v(t,f)=\cfrac{\gamma(t,f)\xi(t,f)}{1+\xi(t,f)}
$$
其中$\xi(t,f)$为先验信噪比，$\gamma(t,f)$为后验信噪比，$p(t,f)$为语音存在概率，$G_{min}$为语音不存在时滤波器的增益下限。

#### 4.对比总结

Zelinski：根据通道间互功率谱密度，采用维纳滤波，抑制不相关散射噪声

mccowan：

MMSE：维纳滤波 使用最小均方误差准则

STSA：移植高斯白噪声

### 8.波束形成特点

| 波束方法   | 固定/自适应 | 噪声场     | 优势                         | 劣势                                       |
| ---------- | ----------- | ---------- | ---------------------------- | ------------------------------------------ |
| delay-sum  | 固定波束    | 非相干     | 简单                         | 混响条件下，效果不好，低频性能差，适用窄带 |
| filter-sum | 固定波束    | 非相干     | 可做恒定宽度波束形成，失真小 | 混响较强，干扰信号多个方向，低频性能差     |
| 超分辨     | 固定波束    | 散射噪声场 | 增益可以提高                 | 假设了散射噪声场                           |
| GSC        | 自适应方法  | 相干       | 自适应噪声场，最小化输出功率 | 低频性能差，阻塞矩阵泄漏导致失真           |
| 后置滤波   | 自适应方法  | 散射噪声场 | 自适应噪声场，提高波束输出   | 属于非线性处理，估计不准引起失真           |

最小方差信号无畸变响应波束形成MVDR：在线性约束条件下，使目标方向上输出信号波束输出最小的方法 ，不失真特性，用于混响和阵列增强。

WebRTC波束基于delay-sum T-F masking：融合的最大信号干扰比SIR，适合处理空间白噪声，散射噪声

## 4.音效算法介绍

### 1.均衡器

#### 1.均衡器概念

音色的感知主要是由于人们在发音时，频谱中不同频段的能量分布不同而导致的。比如声音低沉的人，可能低频分量比较低，而唱高音、音色饱满的人可能高频的能量也能保持得比较多。而其中最直接的可以改变音色，或者说改变声音在不同频率的能量分布的方法就是 EQ，也就是均衡器。

EQ 的处理可用很多通用的滤波器，比如椭圆、切比雪夫、巴特沃斯和贝塞尔滤波器等等。

常用音频处理软件有 FFT 滤波器、图形均衡器（10段）、科学滤波器。

#### 2.均衡器分量调节

20Hz-40Hz:超低音，适当时声音强而有力。能控制雷声、低音鼓、管风琴和贝司的声音。过度提升会使音乐变得混浊不清。 

40Hz-150Hz:低音,是声音的基础部份，其能量占整个音频能量的70%，是表现音乐风格的重要成份。适当时，低音张弛得宜，声音丰满柔和，不足时声音单薄，150Hz，过度提升时会使声音发闷，明亮度下降，鼻音增强。 

150Hz-500Hz:中低音，是声音的结构部分，人声位于这个位置，不足时，演唱声会被音乐淹没，声音软而无力，适当提升时会感到浑厚有力，提高声音的力度和响度。提升过度时会使低音变得生硬，250Hz正增益过多会感受到鼻音。  

500Hz-2KHz:中音，包含大多数乐器的低次谐波和泛音。适当时声音透彻明亮，不足时声音朦胧。过度提升时会产生类似电话的声音。 将500~800 Hz 频率称为“危险频率”，意思是要谨慎使用。由于带宽的原因，电话声主要集中在这段频率，常把 800 Hz和 1 kHz 作较大提升，是电话音模拟效果的主要应用手段。

2KHz-5KHz：中高音，是弦乐的特征音（拉弦乐的弓与弦的摩搡声，弹拔乐的手指触弦的声音某）。不足时声音的穿透力下降，过强时会掩蔽语言音节的识别。  

7KHz-8KHz：高音，是影响声音层次感的频率。过度提升会使短笛、长笛声音突出，语言的齿音加重和音色发毛发刺。  

8KHz-10KHz：极高音， 合适时，三角铁金属感通透率高，沙钟的节奏清晰可辨。过度提升会使声音不自然，易烧毁高频单元。  

### 2.混响

混响信号可以看作是直达声和许多逐步衰减、不断延迟的回声信号叠加而成的。

人工混响则是可以采用多个梳状滤波器的滤波器组，串联全通滤波器来实现，比较常见的有 Scheoeder 和 Moorer 混响模型。

