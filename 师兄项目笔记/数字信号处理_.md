## 1.算法类型

### 1.滤波方法原理

#### 1.谱减法

语音信号对相位不灵敏，在求出谱减后的幅值之后，结合谱减前的相位信息，就能用IFFT求出谱减后的语音信号。

<img src="https://gitee.com/qian-mi/typora_picture/raw/master/img/202209201253007.png" alt="这里写图片描述" style="zoom: 50%;" />

谱减法具有算法简单、运算量小的特点，便于实现快速处理，往往能够获得较高的输出信噪比，所以被广泛采用。该算法经典形式的不足之处是处理后会产生具有一定节奏性起伏、听上去类似音乐的“音乐噪声”。

在帧与帧之间，他们的频率和幅度是随机变化的，做谱减之后，带噪语音的峰值会减小，而谷值由于过估计噪声而被置零，在频谱上只留下波峰，即会产生音乐噪声。从根本上，通常导致音乐噪声的原因主要有：
（1）对谱减算法中的负数部分进行了非线性处理
（2）对噪声谱的估计不准
（3）抑制函数（增益函数）具有较大的可变性

解决音乐噪声的方法：（主要是减小谱估计的波动）

对估计的噪声谱进行平滑处理以减小孤立频点存在峰值的现象，平滑的增益和SNR成正比

流程：噪声估计\==>抑制权重计算\==>后滤波\==>谱减

#### 2.维纳滤波器

​		输入信号y(n)经过一个滤波器后产生一个输出信号x(n)，希望x(n)尽量逼近期望信号d(n)。这可以通过计算估计误差e(n)并使其最小化来实现，能够最小化这个估计误差的最优滤波器叫做维纳滤波器。

![img](https://gitee.com/qian-mi/typora_picture/raw/master/img/202209201254882.png)
$$
x(n)=h(n)*y(n)\\
X(w)=H(w)*Y(w)\\
E(w_k)=D(w_k)-X(w_k)=D(w_k)-H(w_k)*Y(w_k)
$$
根据最小均方误差准则
$$
J=E[|E(w_k)|^2]=E\lbrace [D(w_k)-H(w_k)*Y(w_k)]^*[D(w_k)-H(w_k)*Y(w_k)]\rbrace\\
=E[|D(w_k)|^2]-H(w_k)E[D^*(w_k)Y(w_k)]-H^*(w_k)E[D(w_k)Y^*(w_k)]+|H(w_k)|^2E[|Y(w_k)|^2]\\
$$
令
$$
P_{yy}(w_k)=E[|Y(w_k)|^2]~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~P_{yd}(w_k)=E[Y(w_k)D(w_k)^*]
$$
化简得
$$
J=E[|D(w_k)|^2]-H(w_k)P_{yd}(w_k)-H^*(w_k)P_{yd}^*(w_k)+|H(w_k)|^2P_{yy}(w_k)\\
$$
求导得（H(wk)共轭和H(wk)是两个函数，求导不用复合求导）
$$
\cfrac{\partial J}{\partial H(w_k)}=H^*(w_k)P_{yy}(w_k)-P_{yd}(w_k)=[H(w_k)P_{yy}(w_k)-P_{yd}^*(w_k)]^*=0\\
H(w_k)=\cfrac{P_{yd}^*(w_k)}{P_{yy}(w_k)}
$$
​		如果要把维纳滤波用到语音降噪上，图1中的y(n)就是带噪语音信号，x(n)就是纯净语音信号。假设n(n)表示噪声信号，如果只考虑加性噪声，则带噪语音信号、纯净语音信号和噪声信号的关系如下：y(n) = x(n) + n(n)，做傅里叶变换后的表达式如下：
$$
Y(w_k)=X(w_k)+N(w_k)
$$
 假设噪声与语音不相关且具有零均值，则
$$
P_{yd}(w_k)=E[Y(w_k)X(w_k)^*]=E[(X(w_k)+N(w_k))*X(w_k)^*]\\
=E[(X(w_k)*X(w_k)^*+N(w_k)*X(w_k)^*]=E[(X(w_k)*X(w_k)^*]=P_{xx}(w_k)\\
\\
P_{yy}(w_k)=E[Y(w_k)Y(w_k)^*]=E[(X(w_k)+N(w_k))*(X^*(w_k)+N^*(w_k))]\\
=E[(X(w_k)*X(w_k)^*+X(w_k)*N(w_k)^*+N(w_k)*X(w_k)^*+N(w_k)*N(w_k)^*]\\
=E[(X(w_k)*X(w_k)^*+(N(w_k)*N(w_k)^*]=P_{xx}(w_k)+P_{nn}(w_k)
$$
其中，Pxx表示纯净语音的自功率谱，Pnn表示噪声的自功率谱，由此可得
$$
H(w_k)=\cfrac{P_{xx}(w_k)}{P_{xx}(w_k)+P_{nn}(w_k)}\\
\rho(w_k)=\cfrac{P_{xx}(w_k)}{P_{nn}(w_k)}
$$
p(wk)为频点为wk时的先验信噪比（prior SNR），表示纯净语音和噪声的功率比值，后验信噪比（post SNR）表示带噪语音和噪声的功率比值，得到维纳滤波器的通用的表示形式如下，webRTC里的ANS就是基于这个表达式做语音降噪的。
$$
H(w_k)=\cfrac{\rho(w_k)}{\rho(w_k)+1}
$$

#### 3.卡尔曼滤波

参考链接：https://www.cnblogs.com/ycwang16/p/5999034.html

将系统的状态迁移用状态方程来表述，并用固定维数的矩阵运算递推式代替了维纳滤波的解维数巨大的线性方程组，克服了维纳滤波的一系列局限性

##### 1.符号表示

1. $x_t$，n维向量，表示t时刻观测状态的均值。
2. $P_t$，n∗n方差矩阵，表示t时刻被观测的n个状态的方差。
3. $u_t$，l维向量，表示t时刻的输入
4. $z_t$，m维向量，表示t时刻的观测
5. $A_t$，n∗n矩阵，表示状态从t−1到tt在没有输入影响时转移方式
6. $B_t$，n∗n矩阵，表示u_t如何影响$x_t$
7. $H_t$，m∗nn矩阵，表示状态$x_t$如何被转换为观测$z_t$
8. $R_t$，n∗n矩阵，表示过程噪声$ε_t$的方差矩阵
9. $Q_t$，m∗m矩阵，表示观测噪声$δ_t$的方差矩阵

##### 2.公式流程

Kalman Filter  $(x_{t−1},P_{t−1},u_t,z_t)$

- Prediction（语测）

- - $\hat x_t=A_tx_{t−1}+B_tu_t$
  - $\hat P_t = A_tP_{t−1}A^T_t+R_t$

- Correction（修正）

- - $K_t=\hat P_tH^T_t(H_t\hat P_tH^T_t+Q_t)^{−1}$
  - $x_t=\hat x_t+K_t(z_t−H_t\hat x_t)$
  - $P_t=(I−K_tH_t)\hat P_t$

##### 3.公式解释

- 第一行基于转移矩阵和控制输入，预测tt时刻的状态
- 第二行是预测方差矩阵
- 第三行计算Kalman增益，***K**t*
- 第四行基于观测的新息进行状态更新
- 第五行计算更新状态的方差矩阵。

可以看到算法的所有的精妙之处都在于第三行和第四行。我们可以这样来理解：

1.   $(H_t\hat P_tH^T_t+Q_t)$代表对状态进行观测时，观测的不确定程度，它与Kalman增益$K_t$成反比，表示观测的可能噪声越大的时候，Kalman增益$K_t$越小。

2. 再看第四行，$x_t$的更新是在$\hat x_t$上加一个 $K_t$ 乘以$(z_t−H_t\hat x_t)$。$(z_t−H_t\hat x_t)$代表的是预测的值与观测之间的差异，这个差异当预测和观测都比较接近于真实值时比较小。当观测不准，或者预测不准时都会比较大。而前面的乘子$K_t$噪声大的时候比较小，所以整个$K_t(z_t−H_t\hat x_t)$这个修正量，表示利用观测对预测结果的修正量。

3. - 当观测噪声比较小，预测误差比较大时修正幅度比较大
   - 当观测噪声比较小，预测误差比较小的时候，或者观测噪声比较大的时候，修正误差的幅度也比较小，从而起到了一种平滑的作用。

4. 利用较准确的观测修正预测误差，不准确的观测修正量也较小，所以在误差较大的时候能快速修正，而在误差较小时能逐渐收敛。

##### 4.卡尔曼滤波特点

1. Kalman滤波计算快速，计算复杂度为$O(m^{2.376}+n^2)$，其中m是观测的维数；n是状态的个数。
2. 对于线性系统，零均值高斯噪声的系统，Kalman是理论上无偏的，最优滤波器。
3. Kalman滤波在实际使用中，要注意参数R和Q的调节，这两者实际上是相对的，表示更相信观测还是更相信预测。具体使用时，R可以根据过程噪声的幅度决定，然后Q可以相对R来给定。当更相信观测时，把Q调小，不相信观测时，把Q调大。
4. Q越大，表示越不相信观测，这是系统状态越容易收敛，对观测的变化响应越慢。Q越小，表示越相信观测，这时对观测的变化响应快，但是越不容易收敛。

### 2.滤波器应用条件

#### 1.谱减法

实现谱减法要求：

- 噪声假设为加性噪声；
- 噪声与语音不相关；
- 假设噪声是统计平稳的；

优点：具有算法简单、运算量小的特点，便于实现快速处理，往往能够获得较高的输出信噪比；

缺点：有如上限制；

#### 2.维纳滤波

实现维纳滤波器要求：

- 输入过程是广义平稳的；
- 输入过程的统计特性是已知的；（已知功率谱或是自相关函数）

最优准则：线性最小均方误差估计准则

估计过程：维纳滤波是根据过去的和当前的观测数据，来估计信号的当前值。

#### 3.卡尔曼滤波

实现卡尔曼滤波的要求：

- 能用卡尔曼滤波的前提是这个系统是可观测的。
- 1）系统的状态方程是线性的；2）观测方程是线性的；3）过程噪声符合零均值高斯分布；4）观测噪声符合零均值高斯分布；
- 相比于维纳滤波，卡尔曼滤波可以适用于非平稳随机过程，而且可以递推实现。

最优准则：线性最小均方误差递归估计准则

估计过程：卡尔曼滤波是根据前一个估计值和当前观测值来估计当前信号值的。

缺点：仅能对线性过程和测量模型进行精确的估计，在非线性场景中不能达到最优的估计效果

#### 4.LMS滤波

维纳滤波器参数是固定的，适合于平稳随机信号。卡尔曼滤波器参数是时变的，适合于非平稳随机信号。

然而，只有在信号和噪声的统计特性先验已知的情况下，这两种滤波术才能获得最优滤波。在实际应用中，常常无法得到信号和噪声统计特性的先验知识。在这种情况下，自适应滤波技术能够获得极佳的滤波性能，因而具有很好的应用价值。常用的自适应滤波技术有：最小均方（LMS）自适应滤波器、递推最小二乘（RLS）滤波器；

### 3.短时傅里叶变换（STFT）

#### 1.**语音信号为什么要分帧处理？**

一段完整的语音信号通常是非稳态的，即其特征基本上是随时间变化的，然而由于人的口腔与喉部发声的固有特性，在一个短时间范围内 ，一般为 10∼30ms 之间，其特征基本保持不变，即语音信号是短时平稳的。所以在对语音信号进行频域分析时需要一帧一帧的处理，帧长一般取 10∼30ms 。

#### 2.**为什么要加窗？**

由上文可知，在对语音信号进行分帧FFT变化分析是，是默认对当前帧加了个矩形窗的。会产生频谱泄漏问题。

**频谱泄露：**指某一频率的信号能量扩散到相邻频点的现象。典型的，对语音信号进行STFT时， 就意味着首先要对时域信号进行截断，添加窗函数， 因为对信号加时域窗等效于在频域卷积。 这种截断将导致频谱分析出现误差， 其效果是使得频谱以实际频率值为中心， 以窗函数频谱波形的形状向两侧扩散， 产生“泄漏效应”，即为频谱泄露。

窗函数的原则为：

1、窗函数频谱的主瓣尽量窄，能量尽可能集中在主瓣内，在频谱分析时获得较高的频率分辨率；

2、旁瓣增益应尽量小而且随频率尽快衰减，以减小频谱分析时的泄漏失真。

但主瓣既窄，旁瓣又小衰减又快的窗函数是不容易找到的，比如矩形窗的旁瓣很大，但其主瓣宽度是最窄的，因此，在分析处理对应数据时，需要做综合考虑。

#### 3.**窗函数应该取多长度？**

长窗具有较高的频率分辨率，较低的时间分辨率。长窗起到了时间上的平均作用。窗宽的选择需折中考虑。短窗具有较好的时间分辨率，能够提取出语音信号中的短时变化（这常常是分析的目的），损失了频率分辨率。overelap取帧长的一半。

<img src="https://gitee.com/qian-mi/typora_picture/raw/master/img/202209201254600.jpeg" alt="img" style="zoom: 80%;" />

### 4.卷积与相关

#### 1.卷积定义

$$
y(n)=\sum_{m=-\infin}^{+\infin}x(m)h(n-m) = x(n)*h(n)
$$

#### 2.相关定义

$$
R_{xy}(m)=\sum_{m=-\infin}^{+\infin}x^*(m)y(n+m)\\
R_{x}(m)=\sum_{m=-\infin}^{+\infin}x^*(m)x(n+m)
$$

#### 3.使用卷积计算互相关函数

$$
R_{xy}(m) = x^*(-m)*y(m)
$$

#### 4.相关定理

线性卷积（相关）和圆周卷积（相关）之间的关系

1. 一般的，如果两个有限长序列的长度为$N_1$和$N_2$，且满足$N_1\geq N_2$，则有**圆周卷积**的**后** $N_1-N_2+1$个点，与**线性卷积**的结果一致。
2. 一般的，如果两个有限长序列的长度为$N_1$和$N_2$，且满足$N_1\geq N_2$，则有**圆周相关**的**前** $N_1-N_2+1$个点，与**线性相关**的结果一致。
3. 时域中的圆周卷积对应于其离散傅里叶变换的乘积。
4. 时域中的圆周相关对应于其离散傅里叶变换共轭谱的乘积。

#### 5.为什么时域卷积等于频域乘积

时域信号可以分解成一串不同频率正弦信号的叠加。根据卷积的分配率，两个时域信号的卷积最终可以展开成两两正弦信号的卷积的和。由于不同频率的正弦信号的卷积为0，所以最终只剩下相同频率的正弦信号的卷积。而卷积的结果就是频率不变，幅度相乘。

在频域里边就表现为直接相乘。

### 5.基音周期与共振峰

#### 1.基音周期

基音周期：表示声带的震动周期。根据声带震动的方式的不同，将声音信号分为清音和浊音。其中浊音需要声带周期性震动，所以具有明显的周期性，这种声带振动的频率称为基音频率，相应的周期就成为基音周期。但清音没有明显的周期性。

基于自相关的基音周期检测，基于倒谱的基音周期监测，基于线性预测编码的基音周期检测。

#### 2.共振峰

共振峰是指在声音的频谱中能量相对集中的一些区域，共振峰不但是音质的决定因素，而且反映了声道（共振腔）的物理特征。共振峰是反映声道谐振特性的重要特征，它代表了发音信息的最直接的来源，而且人在语音感知中利用了共振峰信息。

### 6.FIR和IIR设计滤波器

#### 1.FIR滤波器和IIR滤波器的设计

窗函数法设计FIR滤波器

（1）给定所要求的理想频率响应函数$H_d(e^{jw})$，求出反变换$h_d(n)$；

（2）由过度带宽及阻带最小衰减的要求，选定窗函数的形状及N的大小，由此可以得到窗函数的表达式；

（3）求所设计的FIR滤波器的单位冲击响应$h(n)=h_d(n)w(n)$，做FFT得到$H(e^(jw))$；

设计IIR滤波器

（1）根据所要设计滤波器的参数去确定一个模拟滤波器的传输函数；

（2）再根据巴特沃斯型、切比雪夫型等滤波器去模拟低通滤波器；

（3）通过双线性变换、或冲击响应不变法来进行数字滤波器的设计。

#### 2.双线性变换和冲击响应不变法的优缺点

冲击响应不变法

- 优点：模拟频率到数字频率的转换是线性的；
- 缺点：会产生频谱混叠现象，只适合带限滤波器；

双线性变换

- 优点：克服多值映射关系，可以消除频率的混叠；
- 缺点：模拟频率到数字频率的转换是非线性的，在高频由较大的失真；

#### 3.FIR滤波器和IIR滤波器的区别

（1）在相同技术指标下，IIR滤波器由于存在着输出对输入的反馈，IIR滤波阶数比FIR滤波器阶数小；

（2）FIR滤波器可得到严格的线性相位，IIR没有；（IIR滤波器要满足线性相位和幅度滤波要求，必须加全通网络进行相位校正，会大大增加滤波器阶数）；

（3）FIR采用非递归结构，所以较为稳定（极点固定在原点）；IIR滤波器必须采用递归结构，极点必须在单位圆内才稳定（极点在z平面任意位置）；

（4）FIR滤波器冲击响应是有限长，可以使用FFT计算；IIR不可以；

（5）设计IIR滤波器可利用设计模拟滤波器现成的公式，计算量较小；FIR只能通过计算机计算设计；

（6）IIR只能设计规格化的、频率特性为低通、高通、带通、带阻、全通滤波器；FIR滤波器可适应各种幅度特性的要求，更为灵活。

#### 4.线性相位

线性相位能保证信号中各频率成分的相对相位关系不改变。

通俗解释是：信号经过滤波器后，各个频率分量的延时时间是一样的。

### 7.栅栏效应

栅栏效应：只能在基频整数倍的离散点上看到真实的谱。在进行DFT的过程中，最后需要对信号的频谱进行采样。经过这种采样所显示出来的频谱仅在各采样点上，而不在此类点上的频谱都显示不出来，即使在其他点上有重要的峰值也会被忽略，这就是栅栏效应。

解决栅栏效应：

- 在对周期信号DFT处理时，解决栅栏效应可以防止频谱泄露，有效方法是“整周期截取”
- 对于非周期信号，如果希望减少栅栏效应，需要提高频谱分辨率，增加抽样点数（时域补零）能缓解栅栏效应，根本上解决还要提高频率分辨力，增加频域采样点数。

### 8.因果性与稳定性

Z域：
因果性：因果信号的收敛域是某个半径r的圆的外部；非因果信号的收敛域是某个半径r的内部。

稳定性：收敛域包含单位圆则为稳定系统。

因果稳定系统：极点全部都在单位圆内。

S域：
因果性：收敛域位于极点右侧为因果。（即在无穷远处没有极点的系统是因果的，理解：此时级数的上限可以写成∞，即序列可以向后延伸，即为因果）；或可说，系统函数分子阶数高于分母则为因果。
稳定性：收敛域包含y轴则为稳定系统

因果稳定系统：极点全部都在左半平面内。

### 9.FT、DTFT、DFT和DFS

![img](https://picx.zhimg.com/80/v2-018933c62332899a89a17c3203472c6b_720w.webp?source=1940ef5c)

1. 对一个长度为N的有限长序列进行DTFT运算后，再把得到的频谱进行抽样频率为ωs=2π/N 的抽样，抽样后的结果等于对这个序列进行DFT运算的结果；
2. 将长度为N的有限长序列做周期为N的周期延拓后，再进行DFS运算，就是对原有限长序列进行DFT运算。
