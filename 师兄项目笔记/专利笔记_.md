## 专利——滤波优化方法

### 1.整体框图

​		其主要包括四个模块：时域加窗、频域加窗、FFT计算线性卷积、叠接相加还原。装置的输入信号为需要进行滤波的时域长序列信号x(n),频域加窗的的窗口函数可根据滤波要求自行设计，输出信号y(n)为滤波后的时域输出信号。

![image-20220920125220679](https://gitee.com/qian-mi/typora_picture/raw/master/img/202209201252421.png)

### 2.时域加窗

时域加窗的窗函数应该满足两个条件：

（1） 需要用到过渡带较为缓变的窗函数。直接截断会导致频域频谱进行展宽，会引起滤波后的信号失真，故需要使用过渡带较为缓变的窗函数，减少截断对于信号的影响。

（2） 时域加窗虽然会减少频谱泄露，但会使输入信号发生轻微的畸变，在实际操作中可以通过重叠的拼接算法补偿时域加窗带来的影响。

​		将前一帧的后q点作为本帧数据的前q点，再读入输入信号的p点数据作为本帧的后p点数据，长度为N = q + p点，窗函数即要满足上述两个条件，还需要满足加窗函数的过渡带也为q点，同时，做后续的叠接相加法的重叠点数也为q点。故设计叠接相加法所需要的窗函数，设计时域窗函数为
$$
w_0(n)=
\begin{cases}
0.5-0.5cos(\cfrac{\pi n}{q}),&0<=n<=q-1\\
1,&q<=n<=p-1\\
0.5+0.5cos(\frac{\pi(n-p)}{q}),&p<=n<=N-1
\end{cases}
$$

### 3.频域加窗

​		首先，根据系统的滤波要求给出满足要求的理想的频率响应函数Hd(e^jw)，由IFFT变换可计算理想的时域的窗函数为hd(n)。由系统要求的最小阻带衰减可确定窗函数w(n)的形状，由系统要求的过度带宽可确定窗函数阶数M的大小，由此可唯一确定窗函数w(n)。这样即可求出实际滤波器函数的时域表达式为
$$
h(n)=h_d(n)w(n),n=0,1,...,N-1
$$
设定预设滤波器频率范围

|   **频率范围**   | **f11--f12** | **f21--f22** | **...** |   **fg1--fg2**   |
| :--------------: | :----------: | :----------: | :-----: | :--------------: |
| **幅度衰减倍数** |    **A1**    |    **A2**    | **...** |      **Ag**      |
| **预处理后频率** | **f11--f10** | **f10--f20** | **...** | **f(g-1)0--fg2** |

过渡带为
$$
\Delta f=min\lbrace f_{21}-f_{12},f_{31}-f_{13},...,f_{g1}-f_{(g-1)2}\rbrace
$$
对上述的输入频率做预处理，以防止过渡带出现在需要的频率范围内，影响滤波器性能。
$$
f_{i0}=\cfrac{f_{i2}+f_{(i+1)1}}{2},i=1,2,...,g-1
$$
根据上述系统的滤波要求写出理想的频率响应函数为
$$
H_d(e^jw)=
\begin{cases}
A_1e^{-jw\tau},&w_{11}<=|w|<=w_{10}\\
A_2e^{-jw\tau},&w_{21}<=|w|<=w_{20}\\
...\\
A_ge^{-jw\tau},&w_{g1}<=|w|<=w_{g0}
\end{cases}\\
h_d(n)=
\begin{cases}
\cfrac{1}{\pi(n-\tau)}\lbrace \sum_{i=1}^gA_isin[w_{i2}(n-\tau)-A_isin[w_{i1}(n-\tau)]] \rbrace,&n\ne\tau\\
\cfrac{1}{\pi}[\sum_{i=1}^gA_i(w_{i2}-w_{i1})],&n=\tau
\end{cases}\\
\tau=\cfrac{M}{2}
$$
计算常见窗函数基本参数，即窗函数所对应的阻带最小衰减和-60dB过渡带宽c值，其单位为2pi/M。实际的滤波器函数等于理想滤波器函数与窗函数在时域相乘，频域卷积而形成过渡带，所设计出的滤波器函数的过度带 B 应小于系统所允许的过渡带宽，即
$$
\cfrac{2\pi\Delta f}{f_s}=\Delta w>=B=c\cfrac{2\pi}{M}\\
M>=\cfrac{cf_s}{\Delta f}
$$
其中，M 为滤波器的阶数取整数。故由系统要求的阻带最小衰减可确定窗函数的类型及 c 值，由 (1 0 式可确定窗函数阶数，这样可以唯一确定窗函数的时域表达式 𝑤(𝑛)。将 M 带入到 7 式，即可求出理想滤波器的时域表达式 ℎ𝑑(𝑛)，再将 𝑤(𝑛)和 ℎ𝑑(𝑛)带入到之前式子即可求出实际滤波器的时域表达式 ℎ(𝑛)。

### 4.FFT计算线性卷积

要想求N点序列长度的x(n)和M点序列长度的h(n)的线性卷积，需要输出y(n) 的长度L满足
$$
L=2^k>=N+M-1
$$
​		首先，取时域长序列信号时域加窗后的一段信号x(n)，把N点序列长度的x(n)和M点序列长度的h(n)尾后补零至L点，这样可以方便FFT运算，也可以减少栅栏效应。再将补零后的序列x(n)和h(n)做L点的FFT变换，频域相乘再做IFFT反变换得到滤波后的信号y(n)。由于N点序列长度的x(n)和M点序列长度的h(n)的线性卷积会得到N+M-1点长度的信号，所以在输出信号y(n)的L点长度中，只有前N+M-1点长为有用信号，其尾后均为补零数据0值，故需要取  的前N+M-1个数据作为输出结果。具体框图如图4所示。

![FFT计算线性卷积框图](https://gitee.com/qian-mi/typora_picture/raw/master/img/202209201253662.png)

### 5.叠接相加法

在本发明中，将时域长序列信号分段，每段序列长度为N点，共分为DA段。每段数据经过FFT计算线性卷积，得到的每段数据y(n)为输入数据经过时域加窗分段后的N点数据x(n)与h(n)的卷积，长度为N+M-1点。本发明中，在时域加窗时，采用了数据重叠处理的方法，每段输入信号x(n)进行了N点的加窗处理，故卷积后所得的N+M-1点的y(n)相当于时域窗函数的过渡带进行展宽，即有效数据点数不变，应为N-2q+1，过渡带点数由q-1点展宽至H点。
$$
H=\cfrac{N+M-1-(N-2q+1)}{2}=\cfrac{M-1}{2}+q
$$
设x(n)的前后过渡带部分点数均为H，时域加窗部分x(n)需要满足q点数据重叠。故y(n)也需要满足在过渡带部分有q点进行重叠，其余H-q点累加在数据点上，用于防止截断会影响滤波性能。故可以得到每段数据的总体的重叠部分点数为
$$
F=q+H-q+H-q=2H-q=M-1+q\\
p>=M-1+q
$$
如图所示

![叠接相加法还原信号原理图](https://gitee.com/qian-mi/typora_picture/raw/master/img/202209201253446.jpg)

### 6.专利创新点

（1）对长序列做了时域加窗处理和后续的叠接相加处理，先对信号做出了重叠q点的预处理，由此分段信号做时域q点过渡带加窗，后续再通过q点叠接相加还原出原始的信号。这样做抵消了传统FFT滤波引起的截断效应，防止信号失真。

（2）设计频域滤波器函数时，对输入频率做出了预处理，即取用户未限制的频率范围的中心频率做频域加窗，并求出了最小过渡带，使得所设计滤波器的过渡带严格限制在用户规定的频率范围之外。同时，参数的设置只需要输入几段预设的频率范围和最小阻带衰减，本发明即可自动选择窗函数类型和求出最小窗函数阶数，设计出最小阶数的窗函数，再得到后续所输出的滤波器函数。

（3）叠接相加算法合并信号时，为了满足有效数据点严格按照时域加窗分析的q点重叠，先分析了时域窗函数经过频域加窗后的过渡带变化，求出了滤波后的各个分段信号的各个点数的成分，使得分段信号的整体信号做了F点重叠相加。

